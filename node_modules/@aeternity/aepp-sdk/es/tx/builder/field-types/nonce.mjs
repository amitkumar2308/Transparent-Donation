import { isAccountNotFoundError } from "../../../utils/other.mjs";
import shortUInt from "./short-u-int.mjs";
import { ArgumentError } from "../../../utils/errors.mjs";
export default function genNonceField(senderKey) {
  return {
    ...shortUInt,
    async prepare(value, params, options) {
      if (value != null) return value;
      const {
        onNode,
        strategy
      } = options;
      const senderId = options[senderKey];
      const requirement = 'provided (or provide `nonce` instead)';
      if (onNode == null) throw new ArgumentError('onNode', requirement, onNode);
      if (senderId == null) throw new ArgumentError('senderId', requirement, senderId);
      return (await onNode.getAccountNextNonce(senderId.replace(/^ok_/, 'ak_'), {
        strategy
      }).catch(error => {
        if (!isAccountNotFoundError(error)) throw error;
        return {
          nextNonce: 1
        };
      })).nextNonce;
    },
    senderKey
  };
}
//# sourceMappingURL=nonce.mjs.map