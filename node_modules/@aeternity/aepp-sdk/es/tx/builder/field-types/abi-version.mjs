import _buffer from "buffer";
const {
  Buffer: _Buffer
} = _buffer;
import { Tag, ConsensusProtocolVersion } from "../constants.mjs";
import { getProtocolDetails } from "./ct-version.mjs";
export default {
  _getProtocolDetails(c, tag) {
    const kind = Tag.ContractCallTx === tag || Tag.GaMetaTx === tag ? 'contract-call' : 'oracle-call';
    return getProtocolDetails(c, kind).abiVersion;
  },
  serialize(value, _ref, _ref2) {
    let {
      tag
    } = _ref;
    let {
      consensusProtocolVersion = ConsensusProtocolVersion.Iris
    } = _ref2;
    const result = value !== null && value !== void 0 ? value : this._getProtocolDetails(consensusProtocolVersion, tag);
    return _Buffer.from([result]);
  },
  async prepare(value, _ref3,
  // TODO: { consensusProtocolVersion: ConsensusProtocolVersion } | { onNode: Node } | {}
  options) {
    let {
      tag
    } = _ref3;
    if (value != null) return value;
    if (options.consensusProtocolVersion != null) return undefined;
    if (Object.keys(ConsensusProtocolVersion).length === 2) return undefined;
    if (options.onNode != null) {
      return this._getProtocolDetails((await options.onNode.getNodeInfo()).consensusProtocolVersion, tag);
    }
    return undefined;
  },
  deserialize(buffer) {
    return buffer[0];
  }
};
//# sourceMappingURL=abi-version.mjs.map